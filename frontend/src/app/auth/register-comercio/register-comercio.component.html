<div class="d-flex justify-content-center align-items-center vh-100 bg-light">
  <div class="card shadow-lg rounded-4 p-4" style="max-width: 550px; width: 100%;">

    <!-- T√≠tulo y bot√≥n volver -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold mb-0 text-success">Registro de Comercio</h3>
      <button class="btn btn-outline-secondary btn-sm" (click)="cancelar()">‚Üê Volver</button>
    </div>

    <form [formGroup]="form" (ngSubmit)="registrarComercio()">

      <!-- Nombre del comercio -->
      <div class="mb-3">
        <label for="nombre" class="form-label fw-semibold">Nombre del comercio</label>
        <div class="input-group">
          <span class="input-group-text bg-success text-white"><i class="bi bi-shop"></i></span>
          <input id="nombre" type="text" class="form-control" formControlName="nombre" placeholder="Nombre de tu comercio">
        </div>
      </div>

      <!-- Direcci√≥n + usar mi ubicaci√≥n -->
      <div class="mb-3">
        <label for="direccion" class="form-label fw-semibold">Direcci√≥n</label>
        <div class="input-group">
          <span class="input-group-text bg-success text-white"><i class="bi bi-geo-alt"></i></span>
          <input id="direccion" type="text" class="form-control" formControlName="direccion" placeholder="Calle, Ciudad...">
          <button type="button" class="btn btn-success" (click)="usarMiUbicacion()">
            <i class="bi bi-geo"></i> Usar mi ubicaci√≥n
          </button>
        </div>
      </div>

      <!-- üó∫Ô∏è Mapa interactivo -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Selecciona la ubicaci√≥n en el mapa:</label>
        <div class="rounded shadow-sm border" style="overflow: hidden; height: 250px;">
          <app-mapa
            [direccion]="form.get('direccion')?.value"
            (coordenadasSeleccionadas)="onUbicacionSeleccionada($event)">
          </app-mapa>
        </div>
      </div>

      <!-- Horario -->
      <div class="mb-3">
        <label for="horario" class="form-label fw-semibold">Horario</label>
        <div class="input-group">
          <span class="input-group-text bg-success text-white"><i class="bi bi-clock"></i></span>
          <input id="horario" type="text" class="form-control" formControlName="horario" placeholder="Ej: Lun-Vie 9:00-18:00">
        </div>
      </div>

      <!-- Descripci√≥n -->
      <div class="mb-3">
        <label for="descripcion" class="form-label fw-semibold">Descripci√≥n</label>
        <textarea id="descripcion" class="form-control" formControlName="descripcion" rows="3" placeholder="Describe tu comercio"></textarea>
      </div>

      <!-- Imagen del comercio -->
      <div class="mb-3">
        <label for="imagen" class="form-label fw-semibold">Imagen del comercio</label>
        <input id="imagen" type="file" accept="image/*" class="form-control" (change)="onArchivoSeleccionado($event)">
      </div>

      <!-- Vista previa de la imagen -->
      <div class="mb-3" *ngIf="imagenPreview">
        <label class="form-label fw-semibold">Vista previa de la imagen:</label>
        <img
          [src]="imagenPreview"
          alt="Vista previa"
          class="img-thumbnail imagen-preview-circular"
          style="max-width: 300px;">
      </div>

      <!-- Bot√≥n registrar -->
      <button type="submit" class="btn btn-success w-100 py-2 fw-semibold" [disabled]="form.invalid">
        <i class="bi bi-check-circle"></i> Registrar Comercio
      </button>
    </form>
  </div>
</div>

<!-- Modal para recorte -->
<div *ngIf="mostrarCropper" class="modal-backdrop d-flex justify-content-center align-items-center">
  <div class="modal-content p-4 rounded-4 shadow-lg" style="max-width: 400px; width: 100%;">
    <h5 class="fw-semibold text-success mb-3">Recorta la imagen (c√≠rculo)</h5>
    <app-image-cropper
      [imagenBase64]="imagenParaCropper"
      (recortar)="onImagenRecortada($event)"
      (cancelar)="cancelarCropper()">
    </app-image-cropper>
  </div>
</div>
